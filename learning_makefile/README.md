# 一、Make的概念

Make这个词，英语的意思是“制作”。Make命令直接用了这个意思，就是要做出某个文件。比如，要做出a.txt,就可以执行下面的命令

> $ make a.txt

但是，如果你真的输入这条命令，它不会起作用。因为Make命令本身不知道，如何制作出a.txt，需要有人告诉它，如何调用其他命令完成这个目标。

比如，假设文件a.txt依赖于b.txt和c.txt，是后面两个文件连接(cat命令)的产物。那么，make需要知道下面的规则。

<img src = "code.png" width = %>

也就是说，make a.txt这条命令的背后，实际上分为两步：第一步，确认b.txt和c.txt必须已经存在，第二步使用cat命令将这两个文件合并，输出新文件。

像这样的规则，都写在一个叫Makefile的文件中，Make命令依赖于这个文件进行构建。Makefile文件也可以写为makefile，或者用命令行参数指定为其他文件名

> $ make -f rules.txt
> # 或者
> make --file=rules.txt

上面代码指定make命令依据rules.txt文件中的规则，进行构建。

总之，make只是一个根据指定Shell命令进行构建的工具。它的规则很简单，你规定要构建的哪个文件、它依赖哪些源文件，当那些文件有变动时，如何重新构建它。

## 二、Makefile文件格式

> 构建规则都写在Makefile文件里面，要学会如何Make命令，就必须学会如何编写Makefiel文件。


### 2.1 概述

Makefile文件由一系列规则(rules)。每条规则的形式如下：

<target> : <prerequisits>
[tab] <commands>

上面第一行冒号前面的部分，叫做"目标"(target),冒号后面的部分叫做"前置条件"(prerequisits);第二行必须由一个tab键起首，后面跟着“命令”(commands)。

"目标"是必需的，不可省略；"前置条件"和"命令"都是可选的，但是两者之中必须至少存在一个。

每条规则就明确两件事：构建目标的前置条件是什么，以及如何构建。下面就详细讲解，每条规则的这三个组成部分。


### 2.2 目标（target）

一个目标(target)就构成一条规则。目标通常是文件名，指明Make命令所要构建的对象，比如上文的a.txxt。目标也可以是一个文件名，也可以是多个文件名，之间用空格分隔。

除了文件名，目标还可以是某个操作的名字，这称为“伪目标”（phony target）

> clean:
>   rm *.o temp

声明clean是"伪目标"之后，make就不会去检查是否存在一个叫做clean的文件，而是每次运行都执行对应的命令。像.PHONY这样的内置目标名还有不少，可以查看手册。

如果Make命令运行时没有指定目标，默认会执行Makefile文件的第一个目标。

> $ make
上面代码执行Makefile文件的第一个目标。

### 2.3 前置条件(prerequisits)

前置条件通常是一组文件名，之间用空格分隔。它指定了"目标"是否重新构建的判断标准：只要有一个前置文件不存在，或者有过于更新(前置文件的last-modification时间戳比目标的时间戳新)，“目标”就需要重新构建。

> result.txt : source.txt
>     cp source.txt result.txt
